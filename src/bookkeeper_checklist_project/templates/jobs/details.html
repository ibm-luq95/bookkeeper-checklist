{% extends 'core/layouts/dashboard.html' %}
{% load static %}



{% block dashboard_content %}

<section id="manager-job-details">

  <div class="box">
    <div class="columns is-desktop">
      <div class="column is-8">
        <div class="card">
          <header class="card-header">
            <p class="card-header-title has-text-dark has-text-weight-bold is-size-5">{{ object.title }}</p>
            <!-- Start Job Status Form -->
            {% include 'segments/jobs/update_job_status.html' with current_status=object.status job_status=job_status job_object=object.pk %}
            <!-- End Job Status Form -->
          </header>
          <div class="card-content">
            <div class="content">
              <article>
                <section>
                  {{ object.description }}
                </section>
              </article>
              <hr />
              <article class="mt-3">
                <h4>
                  Due Date: <time datetime="{{ object.due_date }}">{{ object.due_date }}</time>
                </h4>
                <hr />
                <h6 class="is-size-6 has-text-grey">
                  Created AT: <time datetime="{{ object.created_at|date }}">{{ object.created_at|date }}</time>
                </h6>
              </article>

              <br />

            </div>
          </div>
          <!-- <footer class="card-footer">
                        <a href="#" class="card-footer-item">Save</a>
                        <a href="#" class="card-footer-item">Edit</a>
                        <a href="#" class="card-footer-item">Delete</a>
                    </footer> -->
        </div>

        <!-- Start Tasks Card -->
        <section id="tasksTableWrapper">
          <div class="card">
            <header class="card-header">
              <p class="card-header-title has-text-dark">Tasks</p>
              {% if perms.task.add_task %}
              <button type="button" id="addTaskBtn"
              class="card-header-icon hint--top bkchlst-input is-disabled is-responsive" disabled
              aria-label="Add new task">
              <span class="icon">
                <i class="fas fa-plus" aria-hidden="true"></i>
              </span>
            </button>
              {% endif %}
            </header>
            <div class="card-content">
              <div class="buttons  is-right">
                <button class="button is-responsive is-rounded is-primary is-light hint--top" id="setTaskCompletedBtn" aria-label="Set tasks completed">Done</button>
                <!-- <button class="button is-responsive is-rounded">Small</button> -->
                <!-- <button class="button is-responsive">Small</button> -->
                <!-- <button class="button is-responsive">Small</button> -->
              </div>
              {% include 'components/task/table_list.html' with client_object=object object_list=object.tasks.all user_type=request.user.user_type enable_create_btn=False perms=perms app_name="task" details_url="task:update" action_urls_pattern="task" enabled_action_btns='update,delete' is_show_checkboxes=True is_show_job_column=False is_show_start_date=False only %}

            </div>
            <!-- <footer class="card-footer">
                                <a href="#" class="card-footer-item">Save</a>
                                <a href="#" class="card-footer-item">Edit</a>
                                <a href="#" class="card-footer-item">Delete</a>
                            </footer> -->
          </div>
        </section>
        <!-- End Tasks Card -->
      </div>


      <div class="column is-4">
        <div class="box pb-1 pt-2 px-0">
          <div class="job-item-block mb-5 is-bordered has-border-bottom-width-1 p-2">
            <article class="media">


              <div class="media-content">
                <div class="content">
                  <a class="button is-fullwidth has-text-weight-bold hint--top" aria-label="Update job details"
                    href="{% url 'jobs:update' object.pk %}" target="_blank">
                    Edit Job
                  </a>
                </div>

              </div>

            </article>
          </div>

          <div class="job-item-block mb-5 is-bordered has-border-bottom-width-1 p-2">
            <article class="media">
              <figure class="media-left mr-5">
                <p class="image is-16x16 is-rounded">
                  <i class="fa-solid fa-2x fa-user-alt has-text-success"></i>
                </p>
              </figure>
              <div class="media-content">
                <div class="content">
                  <p>
                    <strong>Managed by</strong>
                    <!-- <small>@johnsmith</small> <small>31m</small> -->
                    <br />
                    {{ object.managed_by }}


                  </p>
                </div>

              </div>

            </article>
          </div>

          <div class="job-item-block mb-5 is-bordered has-border-bottom-width-1 p-2">
            <article class="media">
              <figure class="media-left mr-5">
                <p class="image is-16x16 is-rounded">
                  <i class="fa-solid fa-building fa-2x has-text-success"></i>
                </p>
              </figure>
              <div class="media-content">
                <div class="content">
                  <p>
                    <strong>Client</strong>
                    <!-- <small>@johnsmith</small> <small>31m</small> -->
                    <br>

                    {% if object.client %}
                    <a href="{% url 'client:details:overview' object.client.pk %}"
                      target="_blank">{{ object.client }}</a>
                    {% else %}
                    No client
                    {% endif %}


                  </p>
                </div>

              </div>

            </article>
          </div>
        </div>

        <div>
          <div id="documentsPanel" class="mb-5">
            <article class="panel is-success">
              <p class="panel-heading">
                Documents
              </p>
              <div class="panel-block">
                <p class="control has-icons-left">
                  {% if perms.documents.add_document %}
                  <button id="addDocumentBtn" aria-label="Add document" type="button"
                  class="button is-success is-outlined is-fullwidth bkchlst-input is-disabled is-responsive hint--top" disabled>
                  <i class="fa-solid fa-plus"></i>
                </button>
                  {% endif %}
                </p>
              </div>

              {% for document in object.documents.filter %}
              <div class="panel-block">
                <a class="is-active " href="{{ document.document_file.url  }}" target="_blank"
                  data-document-id="{{ document.pk }}">
                  <!-- <span class="panel-icon">
                                        <i class="fas fa-book" aria-hidden="true"></i>
                                    </span> -->
                  {{ document.title }}
                </a>
                <div class="field is-grouped is-grouped-right ml-3">
                  <p class="control">
                    <button data-document-id="{{ document.pk }}" data-document-title="{{ document.title }}"
                      class="button is-danger is-light is-small managerDeleteDocumentBtn bkchlst-input is-rounded"
                      disabled type="button">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </p>
                  <p class="control">
                    <a class="button is-info is-light is-small bkchlst-input is-rounded"
                      href="{% url 'documents:update' document.pk %}" target="_blank">
                      <i class="fa-solid fa-pencil"></i>
                    </a>
                  </p>
                </div>

              </div>

              {% empty %}
              <div class="notification is-warning panel-block">
                No document(s)
              </div>
              {% endfor %}



            </article>
          </div>

          <div id="notesPanel">
            <article class="panel is-info">
              <p class="panel-heading">
                Notes
              </p>

              <div class="panel-block">
                <p class="control has-icons-left">
                 {% if perms.notes.add_note %}
                 <button id="addNoteBtn" aria-label="Add note" type="button"
                 class="button is-info is-outlined is-fullwidth bkchlst-input is-disabled is-responsive hint--top" disabled>
                 <i class="fa-solid fa-plus"></i>
               </button>
                 {% endif %}
                </p>
              </div>

              {% for note in object.notes.filter %}
              <div class="panel-block">
                <a class="is-active managerViewNoteBtn" data-note-id="{{ note.pk }}">
                  <!-- <span class="panel-icon">
                                        <i class="fas fa-book" aria-hidden="true"></i>
                                    </span> -->
                  {{ note.title }}
                </a>
                <button data-note-id="{{ note.pk }}" data-note-title="{{ note.title }}"
                  class="button is-danger is-light is-small managerDeleteNoteBtn bkchlst-input ml-5 is-rounded" disabled
                  type="button">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>

              {% empty %}
              <div class="notification is-warning panel-block">
                No note(s)
              </div>
              {% endfor %}
            </article>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
  <!-- Start Task Modal Form -->
  {% include 'segments/tasks/task_modal.html' with user_type="manager" job_object=object task_form=task_form request_object=request %}
  <!-- End Task Modal Form -->
  <!-- Start Document Modal Form -->
  {% include 'segments/documents/document_modal.html' with user_type="manager" job_object=object document_form=document_form request_object=request %}
  <!-- End Document Modal Form -->
  <!-- Start Note Modal Form -->
  {% include 'segments/notes/note_modal.html' with user_type="manager" job_object=object note_form=note_form request_object=request %}
  <!-- End Note Modal Form -->

  {% endblock dashboard_content %}

  {% block externaljs %}
  {% comment  %}
    <script src="{% static 'js/manager/jobs/details.js' %}" defer type="module"></script>
    <script src="{% static 'js/manager/client/segments/tasks.js' %}" defer type="module"></script>
  {% endcomment %}
  <script src="{% static 'js/apps/notes/notes.js' %}" defer type="module"></script>
  <script src="{% static 'js/apps/task/task.js' %}" defer type="module"></script>
  <script src="{% static 'js/apps/documents/documents.js' %}" defer type="module"></script>

  <script src="{% static 'js/segments/jobs/update_job_status.js' %}" defer type="module"></script>
  {% endblock externaljs %}
